<?php
/*
 本代码由 宗师堂 创建
 创建时间 2019-04-09 11:02:42
 技术支持 宗师堂
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace App\Http\Controllers\Api\V1;use App\Http\Controllers\BaseController;use App\Models\Apply;use App\Models\Channel;use App\Models\District;use App\Models\Label;use App\Models\LabelHasChannel;use App\Models\LabelHasProduct;use App\Models\Member;use App\Models\Product;use App\Models\Comment;use App\Models\ProductCollection;use App\Models\ProductDistrict;use App\Models\ProductHasMaterial;use App\Models\ProductPlatform;use App\Models\ProductRangeMoney;use App\Models\ProductMaterial;use App\Models\ProductRangePeriod;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use Illuminate\Support\Facades\DB;use Illuminate\Support\Facades\Log;use Illuminate\Support\Facades\Redis;use Illuminate\Support\Facades\Validator;class LoanController extends BaseController{public function index(Request $request){$validate=Validator::make($request->all(),['city'=>'required',]);$J1f0=!$validate->fails();if($J1f0)goto J1fBodyx2;goto J1fNextx2;J1fBodyx2:$query=Product::where('status',1);$J1f0=$request->sort=='success';if($J1f0)goto J1fBodyx4;goto J1fNextx4;J1fBodyx4:$filed='success_rate';$orderBy='desc';goto J1fx3;J1fNextx4:$J1f0=$request->sort=='speed';if($J1f0)goto J1fBodyx5;goto J1fNextx5;J1fBodyx5:$filed='fast_lend_sort';$orderBy='asc';goto J1fx3;J1fNextx5:$J1f0=$request->sort=='quota';if($J1f0)goto J1fBodyx6;goto J1fNextx6;J1fBodyx6:$filed='quota_max';$orderBy='desc';goto J1fx3;J1fNextx6:$filed='sort';$orderBy='desc';J1fx3:Log::info('--1--');$money=ProductRangeMoney::where('id',$request->input('quota'))->first();$period=ProductRangePeriod::where('id',$request->input('time'))->first();$J1f0=(bool)$money;$J1f1=!$J1f0;if($J1f1)goto J1fBodyx9;goto J1fNextx9;J1fBodyx9:$J1f0=(bool)$period;goto J1fx8;J1fNextx9:J1fx8:if($J1f0)goto J1fBodyxa;goto J1fNextxa;J1fBodyxa:if($money)goto J1fBodyxc;goto J1fNextxc;J1fBodyxc:$J1f0=$money->unit=='yuan';if($J1f0)goto J1fBodyxe;goto J1fNextxe;J1fBodyxe:$J1f0=$money->type==1;if($J1f0)goto J1fBodyxg;goto J1fNextxg;J1fBodyxg:$query->where(function($query)use($money){$query->where('quota_max','<=',$money->per_value)->orWhere(function($query)use($money){$query->where('quota_min','<=',$money->per_value)->where('quota_max','>=',$money->per_value);});});goto J1fxf;J1fNextxg:J1fxf:$J1f0=$money->type==2;if($J1f0)goto J1fBodyxi;goto J1fNextxi;J1fBodyxi:$query->where(function($query)use($money){$query->where('quota_min','<=',$money->min)->where('quota_max','>=',$money->min)->orWhere(function($query)use($money){$query->where('quota_min','>=',$money->min)->where('quota_max','<=',$money->max);})->orWhere(function($query)use($money){$query->where('quota_min','<=',$money->max)->where('quota_max','>=',$money->max);});});goto J1fxh;J1fNextxi:J1fxh:$J1f0=$money->type==3;if($J1f0)goto J1fBodyxk;goto J1fNextxk;J1fBodyxk:$query->where(function($query)use($money){$query->where('quota_min','>=',$money->per_value)->orWhere(function($query)use($money){$query->where('quota_min','<=',$money->per_value)->where('quota_max','>=',$money->per_value);});});goto J1fxj;J1fNextxk:J1fxj:goto J1fxd;J1fNextxe:J1fxd:$J1f0=$money->unit=='wan';if($J1f0)goto J1fBodyxm;goto J1fNextxm;J1fBodyxm:$J1f0=$money->type==1;if($J1f0)goto J1fBodyxo;goto J1fNextxo;J1fBodyxo:$query->where(function($query)use($money){$query->where('quota_max','<=',10000*$money->per_value)->orWhere(function($query)use($money){$query->where('quota_min','<=',10000*$money->per_value)->where('quota_max','>=',10000*$money->per_value);});});goto J1fxn;J1fNextxo:J1fxn:$J1f0=$money->type==2;if($J1f0)goto J1fBodyxq;goto J1fNextxq;J1fBodyxq:$query->where(function($query)use($money){$query->where('quota_min','<=',10000*$money->min)->where('quota_max','>=',10000*$money->min)->orWhere(function($query)use($money){$query->where('quota_min','>=',10000*$money->min)->where('quota_max','<=',10000*$money->max);})->orWhere(function($query)use($money){$query->where('quota_min','<=',10000*$money->max)->where('quota_max','>=',10000*$money->max);});});goto J1fxp;J1fNextxq:J1fxp:$J1f0=$money->type==3;if($J1f0)goto J1fBodyxs;goto J1fNextxs;J1fBodyxs:$query->where(function($query)use($money){$query->where('quota_min','>=',10000*$money->per_value)->orWhere(function($query)use($money){$query->where('quota_min','<=',10000*$money->per_value)->where('quota_max','>=',10000*$money->per_value);});});goto J1fxr;J1fNextxs:J1fxr:goto J1fxl;J1fNextxm:J1fxl:goto J1fxb;J1fNextxc:J1fxb:if($period)goto J1fBodyxu;goto J1fNextxu;J1fBodyxu:$J1f0=$period->type==1;if($J1f0)goto J1fBodyxw;goto J1fNextxw;J1fBodyxw:$J1f0=$period->unit=='week';if($J1f0)goto J1fBodyxy;goto J1fNextxy;J1fBodyxy:$J1f0=$period->per_value*7;$period->per_value=$J1f0;goto J1fxx;J1fNextxy:J1fxx:$J1f0=$period->unit=='month';if($J1f0)goto J1fBodyx11;goto J1fNextx11;J1fBodyx11:$J1f0=$period->per_value*30;$period->per_value=$J1f0;goto J1fxz;J1fNextx11:J1fxz:$J1f0=$period->unit=='year';if($J1f0)goto J1fBodyx13;goto J1fNextx13;J1fBodyx13:$J1f0=$period->per_value*365;$period->per_value=$J1f0;goto J1fx12;J1fNextx13:J1fx12:$query->where(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_max <= ".$period->per_value."
                                                when 'month' then 30*repay_max <= ".$period->per_value."
                                                when 'year' then 365*repay_max <= ".$period->per_value."
                                                else repay_max <= ".$period->per_value."
                                                end
                            ")->orWhere(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min <= ".$period->per_value."
                                    and 7*repay_max >= ".$period->per_value."
                                                when 'month' then 30*repay_min <= ".$period->per_value."
                                                        and 30*repay_max >= ".$period->per_value."
                                                when 'year' then 365*repay_min <= ".$period->per_value."
                                                        and 365*repay_max >= ".$period->per_value."
                                                else repay_min <= ".$period->per_value." and repay_max >= ".$period->per_value."
                                                end
                                    ");});});goto J1fxv;J1fNextxw:J1fxv:$J1f0=$period->type==2;if($J1f0)goto J1fBodyx15;goto J1fNextx15;J1fBodyx15:$J1f0=$period->unit=='week';if($J1f0)goto J1fBodyx17;goto J1fNextx17;J1fBodyx17:$J1f0=$period->min*7;$period->min=$J1f0;$J1f0=$period->max*7;$period->max=$J1f0;goto J1fx16;J1fNextx17:J1fx16:$J1f0=$period->unit=='month';if($J1f0)goto J1fBodyx19;goto J1fNextx19;J1fBodyx19:$J1f0=$period->min*30;$period->min=$J1f0;$J1f0=$period->max*30;$period->max=$J1f0;goto J1fx18;J1fNextx19:J1fx18:$J1f0=$period->unit=='year';if($J1f0)goto J1fBodyx1b;goto J1fNextx1b;J1fBodyx1b:$J1f0=$period->min*365;$period->min=$J1f0;$J1f0=$period->max*365;$period->max=$J1f0;goto J1fx1a;J1fNextx1b:J1fx1a:$query->where(function($query)use($period){$query->where(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min <= ".$period->min."
                                                        and 7*repay_max >= ".$period->min."
                                                when 'month' then 30*repay_min <= ".$period->min."
                                                        and 30*repay_max >= ".$period->min."
                                                when 'year' then 365*repay_min <= ".$period->min."
                                                        and 365*repay_max >= ".$period->min."
                                                else repay_min <= ".$period->min." and repay_max >= ".$period->min."
                                                end
                                    ");})->orWhere(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min >= ".$period->min."
                                                        and 7*repay_max <= ".$period->max."
                                                when 'month' then 30*repay_min >= ".$period->min."
                                                        and 30*repay_max <= ".$period->max."
                                                when 'year' then 365*repay_min >= ".$period->min."
                                                        and 365*repay_max <= ".$period->max."
                                                else repay_min >= ".$period->min." and repay_max <= ".$period->max."
                                                end
                                    ");})->orWhere(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min <= ".$period->max."
                                                        and 7*repay_max >= ".$period->max."
                                                when 'month' then 30*repay_min <= ".$period->max."
                                                        and 30*repay_max >= ".$period->max."
                                                when 'year' then 365*repay_min <= ".$period->max."
                                                        and 365*repay_max >= ".$period->max."
                                                else repay_min <= ".$period->max." and repay_max >= ".$period->max."
                                                end
                                    ");});});goto J1fx14;J1fNextx15:J1fx14:$J1f0=$period->type==3;if($J1f0)goto J1fBodyx1d;goto J1fNextx1d;J1fBodyx1d:$J1f0=$period->unit=='week';if($J1f0)goto J1fBodyx1f;goto J1fNextx1f;J1fBodyx1f:$J1f0=$period->per_value*7;$period->per_value=$J1f0;goto J1fx1e;J1fNextx1f:J1fx1e:$J1f0=$period->unit=='month';if($J1f0)goto J1fBodyx1h;goto J1fNextx1h;J1fBodyx1h:$J1f0=$period->per_value*30;$period->per_value=$J1f0;goto J1fx1g;J1fNextx1h:J1fx1g:$J1f0=$period->unit=='year';if($J1f0)goto J1fBodyx1j;goto J1fNextx1j;J1fBodyx1j:$J1f0=$period->per_value*365;$period->per_value=$J1f0;goto J1fx1i;J1fNextx1j:J1fx1i:$query->where(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min >= ".$period->per_value."
                                                when 'month' then 30*repay_min >= ".$period->per_value."
                                                when 'year' then 365*repay_min >= ".$period->per_value."
                                                else repay_min >= ".$period->per_value."
                                                end
                            ")->orWhere(function($query)use($period){$query->whereRaw("case repay_unit when 'week' then 7*repay_min <= ".$period->per_value."
                                                        and 7*repay_max >= ".$period->per_value."
                                                when 'month' then 30*repay_min <= ".$period->per_value."
                                                        and 30*repay_max >= ".$period->per_value."
                                                when 'year' then 365*repay_min <= ".$period->per_value."
                                                        and 365*repay_max >= ".$period->per_value."
                                                else repay_min <= ".$period->per_value." and repay_max >= ".$period->per_value."
                                                end
                                    ");});});goto J1fx1c;J1fNextx1d:J1fx1c:goto J1fxt;J1fNextxu:J1fxt:goto J1fx7;J1fNextxa:J1fx7:$material_ids=explode(',',$request->input('material'));$J1f0=!empty($material_ids[0]);if($J1f0)goto J1fBodyx1l;goto J1fNextx1l;J1fBodyx1l:$product_material=ProductHasMaterial::whereIn('material_id',$material_ids)->get();if($product_material)goto J1fBodyx1n;goto J1fNextx1n;J1fBodyx1n:$product_material_ids=ProductHasMaterial::whereIn('material_id',$material_ids)->pluck('product_id')->all();goto J1fx1m;J1fNextx1n:$product_material_ids=Product::where('status',1)->pluck('id')->all();J1fx1m:goto J1fx1k;J1fNextx1l:$product_material_ids=Product::where('status',1)->pluck('id')->all();J1fx1k:$platform=$request->platform;$product_platform=ProductPlatform::where('platform',$platform)->get();if($product_platform)goto J1fBodyx1p;goto J1fNextx1p;J1fBodyx1p:$product_platform_ids=ProductPlatform::where('platform',$platform)->distinct('product_id')->pluck('product_id')->all();goto J1fx1o;J1fNextx1p:$product_platform_ids=Product::where('status',1)->pluck('id')->all();J1fx1o:if($request->city)goto J1fBodyx1r;goto J1fNextx1r;J1fBodyx1r:$J1f0=!is_numeric($request->city);if($J1f0)goto J1fBodyx1t;goto J1fNextx1t;J1fBodyx1t:$district=District::where('name','like',"%".$request->city."%")->orderBy('id','asc')->first();if($district)goto J1fBodyx1v;goto J1fNextx1v;J1fBodyx1v:$city=$district->id;goto J1fx1u;J1fNextx1v:$city=0;J1fx1u:goto J1fx1s;J1fNextx1t:$city=$request->city;J1fx1s:goto J1fx1q;J1fNextx1r:$city=0;J1fx1q:if($city)goto J1fBodyx1x;goto J1fNextx1x;J1fBodyx1x:$code=District::where('id',$city)->first()->adcode;$parent_city=District::where('adcode','like',mb_substr($code,0,4). '%')->where('parent_id',0)->first();if($parent_city)goto J1fBodyx2z;goto J1fNextx2z;J1fBodyx2z:$district_product=ProductDistrict::where('district_id',$parent_city->id)->first();goto J1fx1y;J1fNextx2z:$district_product=0;J1fx1y:if($district_product)goto J1fBodyx22;goto J1fNextx22;J1fBodyx22:$city_ids=District::where('adcode','like',mb_substr($code,0,4). '%')->pluck('id')->all();$not_product_ids=ProductDistrict::whereIn('district_id',$city_ids)->distinct('product_id')->pluck('product_id')->all();$all_ids=Product::where('status',1)->pluck('id')->all();$product_ids=array_diff($all_ids,$not_product_ids);goto J1fx21;J1fNextx22:$not_product_ids=ProductDistrict::where('district_id',$city)->distinct('product_id')->pluck('product_id')->all();$all_ids=Product::where('status',1)->pluck('id')->all();$product_ids=array_diff($all_ids,$not_product_ids);J1fx21:$ids=array_intersect($product_material_ids,$product_platform_ids,$product_ids);goto J1fx1w;J1fNextx1x:$ids=array_intersect($product_material_ids,$product_platform_ids);J1fx1w:$products=$query->with(['label','corner'=>function($query){$query->select(['id','name','url']);}])->whereIn('id',$ids)->orderBy($filed,$orderBy)->orderBy('id','desc')->select(['id','name','logo','quota_min','quota_max','slogan','corner_id','market_element','fast_lend_sort'])->paginate($this->page_sizes);if($products->count())goto J1fBodyx24;goto J1fNextx24;J1fBodyx24:foreach($products as&$product){$J1fAC0=array();$tags=$J1fAC0;if($product->label)goto J1fBodyx26;goto J1fNextx26;J1fBodyx26:foreach($product->label as $item){$tags[]=$item->name;$J1f0=$item->name;}$product->tags=$tags;goto J1fx25;J1fNextx26:$J1fAC0=array();$product->tags=$J1fAC0;J1fx25:unset($product->label);unset($product->pivot);if($product->corner)goto J1fBodyx28;goto J1fNextx28;J1fBodyx28:$product->mark=$product->corner;goto J1fx27;J1fNextx28:$product->mark=null;J1fx27:unset($product->corner);unset($product->corner_id);}$this->set('data',$products);goto J1fx23;J1fNextx24:$this->set('type',$this->noContent);$this->set('info','无贷款产品信息');J1fx23:goto J1fx1;J1fNextx2:if($validate->errors()->has('city'))goto J1fBodyx2a;goto J1fNextx2a;J1fBodyx2a:$this->set('type',$this->badRequest);$this->set('info','请传入城市数据');goto J1fx29;J1fNextx2a:J1fx29:J1fx1:return $this->jsonResponse();}public function show(Request $request,$id){$J1fAC0=array();$loan_detail=$J1fAC0;$exists_product=Product::where(['id'=>$id,'status'=>1])->first();if($exists_product)goto J1fBodyx2c;goto J1fNextx2c;J1fBodyx2c:$product=Product::with(['label','material'=>function($query){$query->orderBy('sort','desc')->select(['id','name']);}])->where(['id'=>$id,'status'=>1])->first(['id','name','logo','market_element','corner_id','slogan','rate_unit','rate_value','repay_unit','repay_min','repay_max','quota_min','quota_max','fast_lend_unit','fast_lend_value','success_rate','redirect_url','apply_condition','deal_type']);if($product->label)goto J1fBodyx2e;goto J1fNextx2e;J1fBodyx2e:$J1fAC0=array();$tags=$J1fAC0;foreach($product->label as $item){$tags[]=$item->name;$J1f0=$item->name;}unset($product->label);$product->tags=$tags;goto J1fx2d;J1fNextx2e:J1fx2d:if($product->material)goto J1fBodyx2g;goto J1fNextx2g;J1fBodyx2g:foreach($product->material as $value){unset($value->pivot);}goto J1fx2f;J1fNextx2g:J1fx2f:$J1f0=$product->rate_unit=='day';if($J1f0)goto J1fBodyx2i;goto J1fNextx2i;J1fBodyx2i:$product->rate_unit='天';goto J1fx2h;J1fNextx2i:$J1f0=$product->rate_unit=='month';if($J1f0)goto J1fBodyx2j;goto J1fNextx2j;J1fBodyx2j:$product->rate_unit='月';goto J1fx2h;J1fNextx2j:$product->rate_unit='年';J1fx2h:$J1f0=$product->repay_unit=='day';if($J1f0)goto J1fBodyx2l;goto J1fNextx2l;J1fBodyx2l:$product->repay_unit='天';goto J1fx2k;J1fNextx2l:$J1f0=$product->repay_unit=='month';if($J1f0)goto J1fBodyx2m;goto J1fNextx2m;J1fBodyx2m:$product->repay_unit='月';goto J1fx2k;J1fNextx2m:$product->repay_unit='年';J1fx2k:$J1f0=$product->fast_lend_unit=='minute';if($J1f0)goto J1fBodyx2o;goto J1fNextx2o;J1fBodyx2o:$product->fast_lend_unit='分';goto J1fx2n;J1fNextx2o:$J1f0=$product->fast_lend_unit=='hour';if($J1f0)goto J1fBodyx2p;goto J1fNextx2p;J1fBodyx2p:$product->fast_lend_unit='时';goto J1fx2n;J1fNextx2p:$product->fast_lend_unit='天';J1fx2n:$loan_detail['product']=$product;$uid=$request->uid;if($uid)goto J1fBodyx2r;goto J1fNextx2r;J1fBodyx2r:$comments=Comment::with(['reply'=>function($query){$query->select(['comment_id','content']);},'member'=>function($query){$query->select(['nick','id','avatar']);}])->where(['product_type'=>'product','product_id'=>$id])->where(function($query)use($uid){$query->where(['status'=>1])->orWhere([['mid','=',$uid],['status','=',0]]);})->orderBy('is_wonderful','desc')->orderBy('star','desc')->orderBy('id','desc')->limit(2)->get(['id','comment_type','phone','star','content','created_at','mid']);goto J1fx2q;J1fNextx2r:$comments=Comment::with(['reply'=>function($query){$query->select(['comment_id','content']);},'member'=>function($query){$query->select(['nick','id','avatar']);}])->where(['product_type'=>'product','product_id'=>$id,'status'=>1])->orderBy('is_wonderful','desc')->orderBy('star','desc')->orderBy('id','desc')->limit(2)->get(['id','comment_type','phone','star','content','created_at','mid']);J1fx2q:if($comments->count())goto J1fBodyx2t;goto J1fNextx2t;J1fBodyx2t:foreach($comments as&$comment){$comment->phone=preg_replace('/(\d{3})\d{4}(\d{4})/','$1****$2',$comment->phone);}$loan_detail['comments']=$comments;goto J1fx2s;J1fNextx2t:$J1fAC0=array();$loan_detail['comments']=$J1fAC0;J1fx2s:$avg_star=Comment::where(['product_type'=>'product','product_id'=>$id,'status'=>1])->avg('star');$J1f0=$this->product_share . $product->id;$J1f1=$J1f0 . '?type=app&share=1&Channel=';$J1f2=$J1f1 . $request->channel;$loan_detail['share_link']=$J1f2;$AA_A_A="ceil";$J1fAC0=$AA_A_A($avg_star);$J1f0=$J1fAC0==null;if($J1f0)goto J1fBodyx2v;goto J1fNextx2v;J1fBodyx2v:$loan_detail['avg_star']=5;goto J1fx2u;J1fNextx2v:$AA_AA_="ceil";$J1fAC0=$AA_AA_($avg_star);$loan_detail['avg_star']=$J1fAC0;J1fx2u:if($uid)goto J1fBodyx2x;goto J1fNextx2x;J1fBodyx2x:$total_comments=Comment::where(['product_type'=>'product','product_id'=>$id])->where(function($query)use($uid){$query->where(['status'=>1])->orWhere([['mid','=',$uid],['status','=',0]]);})->count();goto J1fx2w;J1fNextx2x:$total_comments=Comment::where(['product_type'=>'product','product_id'=>$id])->where(function($query){$query->where(['status'=>1]);})->count();J1fx2w:$loan_detail['total_comments']=$total_comments;$ids=$this->cityPlatform($request);$applys=Apply::where(['mid'=>$request->uid,'type'=>'product'])->get(['product_id']);if($applys)goto J1fBodyx3z;goto J1fNextx3z;J1fBodyx3z:$apply_ids=Apply::where(['mid'=>$request->uid,'type'=>'product'])->distinct('product_id')->pluck('product_id')->all();$AA_AAA="count";$J1fAC0=$AA_AAA($apply_ids);$AAA___="count";$J1fAC1=$AAA___($ids);$J1f0=$J1fAC0>$J1fAC1;if($J1f0)goto J1fBodyx32;goto J1fNextx32;J1fBodyx32:$applys_arr=array_diff($apply_ids,$ids);goto J1fx31;J1fNextx32:$applys_arr=array_diff($ids,$apply_ids);J1fx31:$J1fAC0=array();$J1f0=$applys_arr==$J1fAC0;if($J1f0)goto J1fBodyx34;goto J1fNextx34;J1fBodyx34:$J1fAC0=array();$J1fAC0[]=$id;$apply_ids=$J1fAC0;goto J1fx33;J1fNextx34:array_push($apply_ids,$id);J1fx33:goto J1fx2y;J1fNextx3z:$J1fAC0=array();$J1fAC0[]=$id;$apply_ids=$J1fAC0;J1fx2y:$guess_like=Product::with(['label'=>function($query){$query->select(['id','name']);},'corner'=>function($query){$query->select(['id','name','url']);}])->where(['status'=>1])->whereRaw("JSON_CONTAINS(guess_like,'[\"product\"]')")->whereIn('id',$ids)->whereNotIn('id',$apply_ids)->orderBy('id','desc')->take(3)->get(['id','name','corner_id','logo','slogan','quota_min','quota_max','market_element']);if($guess_like->count())goto J1fBodyx36;goto J1fNextx36;J1fBodyx36:foreach($guess_like as&$item){$J1fAC0=array();$tags=$J1fAC0;if($item->label)goto J1fBodyx38;goto J1fNextx38;J1fBodyx38:foreach($item->label as $value){$tags[]=$value->name;$J1f0=$value->name;}$item->tags=$tags;goto J1fx37;J1fNextx38:$J1fAC0=array();$item->tags=$J1fAC0;J1fx37:unset($item->label);if($item->corner)goto J1fBodyx3a;goto J1fNextx3a;J1fBodyx3a:$item->mark=$item->corner;goto J1fx39;J1fNextx3a:$item->mark=null;J1fx39:unset($item->corner);}$loan_detail['guess_like']=$guess_like;goto J1fx35;J1fNextx36:$J1fAC0=array();$loan_detail['guess_like']=$J1fAC0;J1fx35:if($request->uid)goto J1fBodyx3c;goto J1fNextx3c;J1fBodyx3c:$collectoin=ProductCollection::where(['mid'=>$request->uid,'product_id'=>$id])->first();if($collectoin)goto J1fBodyx3e;goto J1fNextx3e;J1fBodyx3e:$loan_detail['is_collection']=1;goto J1fx3d;J1fNextx3e:$loan_detail['is_collection']=0;J1fx3d:goto J1fx3b;J1fNextx3c:$loan_detail['is_collection']=0;J1fx3b:$this->set('data',$loan_detail);goto J1fx2b;J1fNextx2c:$this->set('type',$this->noContent);$this->set('info','该产品已下架，如有疑问请联系客服。');J1fx2b:return $this->jsonResponse();}public function screen(){$moneys=ProductRangeMoney::orderBy('sort','desc')->get();$AAA__A="count";$J1fAC0=$AAA__A($moneys);if($J1fAC0)goto J1fBodyx3g;goto J1fNextx3g;J1fBodyx3g:foreach($moneys as&$money){$J1f0=$money->unit=='yuan';if($J1f0)goto J1fBodyx3i;goto J1fNextx3i;J1fBodyx3i:$unit='元';goto J1fx3h;J1fNextx3i:$unit='万';J1fx3h:$J1f0=$money->type==1;if($J1f0)goto J1fBodyx3k;goto J1fNextx3k;J1fBodyx3k:$J1f0='小于' . $money->per_value;$J1f1=$J1f0 . $unit;$money->quota=$J1f1;goto J1fx3j;J1fNextx3k:$J1f0=$money->type==2;if($J1f0)goto J1fBodyx3l;goto J1fNextx3l;J1fBodyx3l:$J1f0=$money->min . '-';$J1f1=$J1f0 . $money->max;$J1f2=$J1f1 . $unit;$money->quota=$J1f2;goto J1fx3j;J1fNextx3l:$J1f0=$money->type==3;if($J1f0)goto J1fBodyx3m;goto J1fNextx3m;J1fBodyx3m:$J1f0=$money->per_value . $unit;$J1f1=$J1f0 . '以上';$money->quota=$J1f1;goto J1fx3j;J1fNextx3m:$money->quota='不限';J1fx3j:unset($money->type);unset($money->unit);unset($money->min);unset($money->max);unset($money->per_value);unset($money->sort);unset($money->created_at);unset($money->updated_at);}$moneys=$moneys->toArray();goto J1fx3f;J1fNextx3g:$J1fAC0=array();$moneys=$J1fAC0;J1fx3f:array_push($moneys,['id'=>0,'quota'=>'不限']);$materials=ProductMaterial::orderBy('sort','desc')->get(['id','name']);$materials=$materials->toArray();$AAA_A_="count";$J1fAC0=$AAA_A_($materials);$J1f0=$J1fAC0==0;if($J1f0)goto J1fBodyx3o;goto J1fNextx3o;J1fBodyx3o:$J1fAC0=array();$materials=$J1fAC0;goto J1fx3n;J1fNextx3o:J1fx3n:array_push($materials,['id'=>0,'name'=>'不限']);$periods=ProductRangePeriod::orderBy('sort','desc')->get();$AAA_AA="count";$J1fAC0=$AAA_AA($periods);if($J1fAC0)goto J1fBodyx3q;goto J1fNextx3q;J1fBodyx3q:foreach($periods as&$period){$J1f0=$period->unit=='day';if($J1f0)goto J1fBodyx3s;goto J1fNextx3s;J1fBodyx3s:$unit='天';goto J1fx3r;J1fNextx3s:$J1f0=$period->unit=='week';if($J1f0)goto J1fBodyx3t;goto J1fNextx3t;J1fBodyx3t:$unit='周';goto J1fx3r;J1fNextx3t:$J1f0=$period->unit=='month';if($J1f0)goto J1fBodyx3u;goto J1fNextx3u;J1fBodyx3u:$unit='月';goto J1fx3r;J1fNextx3u:$unit='年';J1fx3r:$J1f0=$period->type==1;if($J1f0)goto J1fBodyx3w;goto J1fNextx3w;J1fBodyx3w:$J1f0='小于' . $period->per_value;$J1f1=$J1f0 . $unit;$period->period=$J1f1;goto J1fx3v;J1fNextx3w:$J1f0=$period->type==2;if($J1f0)goto J1fBodyx3x;goto J1fNextx3x;J1fBodyx3x:$J1f0=$period->min . '-';$J1f1=$J1f0 . $period->max;$J1f2=$J1f1 . $unit;$period->period=$J1f2;goto J1fx3v;J1fNextx3x:$J1f0=$period->type==3;if($J1f0)goto J1fBodyx3y;goto J1fNextx3y;J1fBodyx3y:$J1f0=$period->per_value . $unit;$J1f1=$J1f0 . '以上';$period->period=$J1f1;goto J1fx3v;J1fNextx3y:$period->period='不限';J1fx3v:unset($period->type);unset($period->unit);unset($period->min);unset($period->max);unset($period->per_value);unset($period->sort);unset($period->created_at);unset($period->updated_at);}$periods=$periods->toArray();array_push($periods,['id'=>0,'period'=>'不限']);goto J1fx3p;J1fNextx3q:$J1fAC0=array();$periods=$J1fAC0;J1fx3p:$J1fAC0=array();$J1f0=$moneys==$J1fAC0;$J1f3=(bool)$J1f0;if($J1f3)goto J1fBodyx44;goto J1fNextx44;J1fBodyx44:$J1fAC1=array();$J1f2=(bool)$J1fAC1;if($J1f2)goto J1fBodyx42;goto J1fNextx42;J1fBodyx42:$J1fAC2=array();$J1f1=$periods==$J1fAC2;$J1f2=(bool)$J1f1;goto J1fx41;J1fNextx42:J1fx41:$materials=$J1f2;$J1f3=(bool)$materials;goto J1fx43;J1fNextx44:J1fx43:if($J1f3)goto J1fBodyx45;goto J1fNextx45;J1fBodyx45:goto J1fx4z;J1fNextx45:J1fx4z:$J1fAC0=array();$J1fAC0['quotas']=$moneys;$J1fAC0['materials']=$materials;$J1fAC0['periods']=$periods;$arr=$J1fAC0;$this->set('data',$arr);return $this->jsonResponse();}}
?>